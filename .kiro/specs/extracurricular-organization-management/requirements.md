# Requirements Document

## はじめに
課外活動団体管理システムは、大学や学校における課外活動団体の効率的な管理を実現するWebアプリケーションです。職員、団体長、メンバー、一般ユーザーの4段階の権限体系により、適切なアクセス制御を提供し、団体とメンバーの包括的な管理機能を提供します。

## 要件

### 要件1: ユーザー認証システム
**目的:** ユーザーとして、安全にシステムにアクセスできるようにしたい。そうすることで、個人情報と団体情報が適切に保護される。

#### 受入基準
1. WHEN ユーザーがメールアドレスとパスワードでログインを試行する THEN システムは認証情報を検証し、成功時にセッションを確立する
2. WHEN ユーザーがGitHubアカウントでログインを試行する THEN システムはOAuth認証を実行し、成功時にアカウントを作成または既存アカウントにリンクする
3. WHEN ユーザーがパスワードリセットを要求する THEN システムは確認済みメールアドレスにリセットリンクを送信する
4. WHEN ユーザーが新規アカウントを作成する THEN システムはメールアドレス確認を要求し、確認完了まで機能を制限する
5. WHEN ユーザーがログアウトする THEN システムはセッションを無効化し、ホームページにリダイレクトする

### 要件2: 権限管理システム
**目的:** 管理者として、ユーザーの役割に応じて適切なアクセス権限を設定したい。そうすることで、情報セキュリティと運用効率が向上する。

#### 受入基準
1. WHEN システムがユーザーの権限を確認する THEN システムは職員（admin）、団体長（leader）、メンバー（user）、一般ユーザーの4段階で権限を判定する
2. WHEN 職員がシステムにアクセスする THEN システムは全ての団体とメンバーの管理機能へのアクセスを許可する
3. WHEN 団体長がシステムにアクセスする THEN システムは所属団体のメンバー管理と団体情報編集機能へのアクセスを許可する
4. WHEN メンバーがシステムにアクセスする THEN システムは所属団体の情報閲覧と自身のプロフィール編集機能へのアクセスを許可する
5. WHEN 一般ユーザーがシステムにアクセスする THEN システムは公開団体情報の閲覧機能のみへのアクセスを許可する
6. WHEN ユーザーが権限外の機能にアクセスを試行する THEN システムはアクセスを拒否し、適切なエラーメッセージを表示する

### 要件3: 課外活動団体管理
**目的:** 職員として、課外活動団体の情報を効率的に管理したい。そうすることで、団体運営の透明性と効率性が向上する。

#### 受入基準
1. WHEN 職員が新しい団体を作成する THEN システムは団体名、説明、設立日、活動分野、連絡先情報を記録する
2. WHEN 職員が団体情報を更新する THEN システムは変更内容を検証し、更新履歴を記録する
3. WHEN 職員が団体一覧を表示する THEN システムは全ての団体を活動状況、メンバー数、最終更新日と共に表示する
4. WHEN 職員が団体を検索する THEN システムは団体名、活動分野、設立年での絞り込み機能を提供する
5. WHEN 職員が団体を削除する THEN システムは確認ダイアログを表示し、関連するメンバー情報の処理方法を確認する
6. WHEN 団体長が所属団体情報を編集する THEN システムは基本情報の更新を許可し、重要な変更は職員承認を要求する

### 要件4: メンバー管理システム
**目的:** 団体長として、団体メンバーの情報を適切に管理したい。そうすることで、メンバーの参加状況と貢献度を把握できる。

#### 受入基準
1. WHEN 団体長が新しいメンバーを追加する THEN システムはユーザーアカウントと団体の関連付けを作成し、参加日を記録する
2. WHEN 団体長がメンバー一覧を表示する THEN システムは所属団体のメンバーを役職、参加日、活動状況と共に表示する
3. WHEN 団体長がメンバーの役職を変更する THEN システムは変更権限を確認し、変更履歴を記録する
4. WHEN 団体長がメンバーを団体から除名する THEN システムは確認プロセスを実行し、メンバーの権限を適切に更新する
5. WHEN メンバーが自身のプロフィールを更新する THEN システムは基本情報の変更を許可し、重要な変更は団体長通知を送信する
6. WHEN 職員がメンバー情報を検索する THEN システムは全団体のメンバーを名前、所属団体、参加期間で検索する機能を提供する

### 要件5: データ整合性とセキュリティ
**目的:** システム管理者として、データの整合性とセキュリティを確保したい。そうすることで、システムの信頼性と安全性が保たれる。

#### 受入基準
1. WHEN システムがデータを保存する THEN システムは入力値の妥当性を検証し、不正なデータの保存を防止する
2. WHEN ユーザーが機密情報にアクセスする THEN システムはアクセスログを記録し、不正アクセスの監視を行う
3. WHEN システムがパスワードを処理する THEN システムは適切なハッシュ化を実行し、平文での保存を禁止する
4. WHEN データベースの整合性が損なわれる THEN システムはトランザクションをロールバックし、エラーログを記録する
5. WHEN システムがメール通知を送信する THEN システムは送信履歴を記録し、配信失敗時の再試行機能を提供する
